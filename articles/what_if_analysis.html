<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>What If Analysis • cma</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="What If Analysis">
<meta property="og:description" content="cma">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cma</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/panic_copula.html">Panic Copula</a>
    </li>
    <li>
      <a href="../articles/what_if_analysis.html">What If Analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Reckziegel/CMA">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="what_if_analysis_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>What If Analysis</h1>
            
      
      
      <div class="hidden name"><code>what_if_analysis.Rmd</code></div>

    </div>

    
    
<p>This brief introduction shows how use CMA to price alternative scenarios for an investment strategy. The recipe goes as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Detach the copulas from the margins;</p></li>
<li>
<p>Pick one element to play with;</p>
<ul>
<li>Example: if the “Market” is normally distributed, the t-distribution could be used to see how VaR and CVaR changes;</li>
</ul>
</li>
<li><p>Generate new scenarios;</p></li>
<li><p>Merge the newly generated scenarios with the empirical copulas.</p></li>
</ol>
<p>For this vignette, the <code>EuStockMarket</code> dataset is used as <em>proxy</em> for the “Market”.</p>
<p>The setup goes as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cma</span><span class="op">)</span>     <span class="co"># core package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>   <span class="co"># data manipulation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>   <span class="co"># data manipulation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>   <span class="co"># vetorized loops</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># plotting</span>

<span class="co"># compute log returns (stationarity)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">n_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt;              [,1]         [,2]         [,3]         [,4]</span>
<span class="co">#&gt; [1,] -0.009326550  0.006178360 -0.012658756  0.006770286</span>
<span class="co">#&gt; [2,] -0.004422175 -0.005880448 -0.018740638 -0.004889587</span>
<span class="co">#&gt; [3,]  0.009003794  0.003271184 -0.005779182  0.009027020</span>
<span class="co">#&gt; [4,] -0.001778217  0.001483372  0.008743353  0.005771847</span>
<span class="co">#&gt; [5,] -0.004676712 -0.008933417 -0.005120160 -0.007230164</span>
<span class="co">#&gt; [6,]  0.012427042  0.006737244  0.011714353  0.008517217</span></code></pre></div>
<div id="step-1--separate-the-copulas-from-the-margins" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1--separate-the-copulas-from-the-margins" class="anchor"></a>Step 1. Separate the Copulas from the Margins</h2>
<p>The first step evolves separating the margins from the copulas with <code><a href="../reference/cma_separation.html">cma_separation()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First CMA Step</span>
<span class="va">step_one</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cma_separation.html">cma_separation</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">step_one</span>
<span class="co">#&gt; # CMA Decomposition</span>
<span class="co">#&gt; marginal: &lt;&lt; tbl 1859 x 4 &gt;&gt;</span>
<span class="co">#&gt; cdf     : &lt;&lt; tbl 1859 x 4 &gt;&gt;</span>
<span class="co">#&gt; copula  : &lt;&lt; tbl 1859 x 4 &gt;&gt;</span></code></pre></div>
<p>The output is a list with three components: the margins, the CDF, and the copula.</p>
<p>In this vignette, the margins are manipulated while keeping the copula structure unchanged.</p>
</div>
<div id="step-2--choose-a-target-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2--choose-a-target-distribution" class="anchor"></a>Step 2. Choose a Target Distribution</h2>
<p>Once the the “separation” is done it’s necessary to choose a target distribution for the data. For simplicity, let’s fit a Student-t, but it could be <em>any</em> distribution (see “Marginal Distributions” on the reference page).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dist_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_t.html">fit_t</a></span><span class="op">(</span><span class="va">step_one</span><span class="op">$</span><span class="va">marginal</span><span class="op">)</span>
<span class="va">dist_t</span>
<span class="co">#&gt; # Margins Estimation</span>
<span class="co">#&gt; Converged:       TRUE</span>
<span class="co">#&gt; Dimension:       4</span>
<span class="co">#&gt; AIC:            -52711.16</span>
<span class="co">#&gt; Log-Likelihood:  26374.58</span>
<span class="co">#&gt; Model:           Asymmetric Student-t</span></code></pre></div>
</div>
<div id="step-3--create-new-scenarios" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3--create-new-scenarios" class="anchor"></a>Step 3. Create New Scenarios</h2>
<p>The next step requires some <code>tidyverse</code> skills.</p>
<p>Start building a list-column for the new scenarios wit <code><a href="../reference/generate_margins.html">generate_margins()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simul_tbl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>simulations <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> |&gt; 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>new_scenarios <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
        .x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">n_row</span>, <span class="fl">100</span><span class="op">)</span>, 
        .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/generate_margins.html">generate_margins</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">dist_t</span>, n <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>
        <span class="op">)</span>
    <span class="op">)</span> |&gt; 
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">new_scenarios</span><span class="op">)</span>
<span class="va">simul_tbl</span>
<span class="co">#&gt; # A tibble: 100 × 2</span>
<span class="co">#&gt;    simulations new_scenarios</span>
<span class="co">#&gt;          &lt;int&gt;   &lt;list&lt;dbl&gt;&gt;</span>
<span class="co">#&gt;  1           1   [1,859 × 4]</span>
<span class="co">#&gt;  2           2   [1,859 × 4]</span>
<span class="co">#&gt;  3           3   [1,859 × 4]</span>
<span class="co">#&gt;  4           4   [1,859 × 4]</span>
<span class="co">#&gt;  5           5   [1,859 × 4]</span>
<span class="co">#&gt;  6           6   [1,859 × 4]</span>
<span class="co">#&gt;  7           7   [1,859 × 4]</span>
<span class="co">#&gt;  8           8   [1,859 × 4]</span>
<span class="co">#&gt;  9           9   [1,859 × 4]</span>
<span class="co">#&gt; 10          10   [1,859 × 4]</span>
<span class="co">#&gt; # … with 90 more rows</span></code></pre></div>
<p>The <code>simul_tbl</code> is a <em>tidy</em> (long-format) <code>tibble</code> with 100 marginal distributions that are consistent with the <code>dist_t</code> object fitted in step 2 (every row in <code>new_scenarios</code> holds a different simulation).</p>
</div>
<div id="step-4--glue-the-new-scenarios-into-the-empirical-copula" class="section level2">
<h2 class="hasAnchor">
<a href="#step-4--glue-the-new-scenarios-into-the-empirical-copula" class="anchor"></a>Step 4. “Glue” the New Scenarios Into the Empirical Copula</h2>
<p>To complete the scenario generation process it’s important to “glue” the simulations back into the empirical copula that is stored in <code>step_one</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">step_two</span> <span class="op">&lt;-</span> <span class="va">simul_tbl</span> |&gt; 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cma_comb <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
        .x <span class="op">=</span> <span class="va">new_scenarios</span>, 
        .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/cma_combination.html">cma_combination</a></span><span class="op">(</span>
            x      <span class="op">=</span> <span class="va">.x</span>,
            cdf    <span class="op">=</span> <span class="va">step_one</span><span class="op">$</span><span class="va">cdf</span>, 
            copula <span class="op">=</span> <span class="va">step_one</span><span class="op">$</span><span class="va">copula</span><span class="op">)</span>
        <span class="op">)</span>
    <span class="op">)</span>
<span class="va">step_two</span>
<span class="co">#&gt; # A tibble: 100 × 3</span>
<span class="co">#&gt;    simulations new_scenarios cma_comb            </span>
<span class="co">#&gt;          &lt;int&gt;   &lt;list&lt;dbl&gt;&gt; &lt;named list&gt;        </span>
<span class="co">#&gt;  1           1   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt;  2           2   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt;  3           3   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt;  4           4   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt;  5           5   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt;  6           6   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt;  7           7   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt;  8           8   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt;  9           9   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt; 10          10   [1,859 × 4] &lt;tibble [1,859 × 4]&gt;</span>
<span class="co">#&gt; # … with 90 more rows</span></code></pre></div>
<p>The <code>cma_comb</code> column now holds 100 simulations that, although being different, share a bond to each other because the structure of their copula is the same.</p>
<p>Finally, it’s possible to compute the performance of those realizations over an equal-weight strategy, for example (it could be <em>any</em> strategy).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">step_two</span> <span class="op">&lt;-</span> <span class="va">step_two</span> |&gt; 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, 
                  pnl     <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">cma_comb</span>, 
                                        .y <span class="op">=</span> <span class="va">weights</span>, 
                                        .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span> |&gt; 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cma_comb</span>, <span class="va">weights</span><span class="op">)</span><span class="op">)</span>
<span class="va">step_two</span>
<span class="co">#&gt; # A tibble: 100 × 3</span>
<span class="co">#&gt;    simulations new_scenarios pnl              </span>
<span class="co">#&gt;          &lt;int&gt;   &lt;list&lt;dbl&gt;&gt; &lt;named list&gt;     </span>
<span class="co">#&gt;  1           1   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt;  2           2   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt;  3           3   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt;  4           4   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt;  5           5   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt;  6           6   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt;  7           7   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt;  8           8   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt;  9           9   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt; 10          10   [1,859 × 4] &lt;dbl [1,859 × 1]&gt;</span>
<span class="co">#&gt; # … with 90 more rows</span></code></pre></div>
<p>Translate compounded returns to prices and plot:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">step_two</span> |&gt; 
    <span class="co"># price</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pnl_prices <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">pnl</span>, .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                  pnl_ref    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> |&gt; 
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pnl_prices</span>, <span class="va">pnl_ref</span><span class="op">)</span><span class="op">)</span> |&gt; 
    
    <span class="co"># build an index</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">simulations</span><span class="op">)</span> |&gt; 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rowid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_row</span><span class="op">)</span> |&gt; 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
    
    <span class="co"># plot</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rowid</span>, y <span class="op">=</span> <span class="va">pnl_prices</span>, group <span class="op">=</span> <span class="va">simulations</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pnl_ref</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"EuStockMarkets Equal Weight Strategy"</span>, 
                  subtitle <span class="op">=</span> <span class="st">"Realized vs. Alternative Scenarios"</span>, 
                  x        <span class="op">=</span> <span class="st">"Time Evolution"</span>, 
                  y        <span class="op">=</span> <span class="st">"P&amp;L"</span><span class="op">)</span></code></pre></div>
<p><img src="what_if_analysis_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>All the paths generated above are compatible with the same marginal distribution specification. The difference between the “good” portfolios and the “bad” ones is purely due by chance. Indeed, differentiating between skill and luck is notoriously difficult.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bernardo Reckziegel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
